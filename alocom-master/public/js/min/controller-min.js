var FACEBOOK_ID=localStorage.getItem("fbid"),FULLNAME=localStorage.getItem("fullname");app.controller("GCController",function(e,n,o){var t=this,s="";t.today=function(){var e=new Date;return e.getDate()+"/"+(e.getMonth()+1)},t.menu={visible:!1,raw:"",array:[],host:{fbid:0,fullname:""},onConfirm:function(){this.visible=!1;for(var e=this.raw.split(/\s*\n\s*/),o=[],t=/^[0-9]+\.\s+.+$/,r=0;r<e.length;r++){var i=e[r];t.test(i)&&o.push(i)}console.log("con heo",o),n.post(s+"/menu",{menu:o,fbid:FACEBOOK_ID,fullname:FULLNAME}).success(function(e){console.log(e),u()})}},t.vote={doVote:function(e){n.post(s+"/vote",{dish:e.id,fbid:FACEBOOK_ID,fullname:FULLNAME}).success(function(){u()})},checkYou:function(e){for(var n=0;n<e.list.length;n++)if(e.list[n].fbid===FACEBOOK_ID)return!0;return!1}},t.users={all:[],checked:{}};var u=function(){n.get(s+"/menu").success(function(e){t.menu.array=e.menu,t.menu.host=e.host,t.users.checked={};for(var n=0;n<e.menu.length;n++)for(var o=e.menu[n].list,s=0;s<o.length;s++)t.users.checked[o[s].fbid]=!0;r()}).error(function(){t.menu.array=fakeMenu.menu})},r=function(){n.get(s+"/users").success(function(e){t.users.all=e.users})};u(),t.loggined=function(e,n){FACEBOOK_ID=e,FULLNAME=n,console.log("fbid = ",e,"name = ",n)},t.sendDone=function(){n.post(s+"/done",{fbid:FACEBOOK_ID,fullname:FULLNAME})},t.isHost=function(){return FACEBOOK_ID==t.menu.host.fbid},o(u,5e3)});